# ExprCalculator2：高级数学表达式计算器

一个基于 C++ 开发的高级表达式计算器，支持复杂数学运算、变量定义、函数调用和逻辑判断，适用于快速计算与公式验证场景。

---

## ✅ 核心功能

- **基础运算**：`+`、`-`、`*`、`/`
- **优先级控制**：支持括号 `()` 改变运算顺序
- **符号处理**：支持正负前缀（如 `-5`、`+3`）
- **幂运算**：`^` 或 `**` 两种符号
- **取模运算**：`%`
- **运算规则**：严格遵循运算符优先级和结合性
- **错误提示**：提供清晰的错误信息（如除零错误、未定义变量）

---

## ⚙️ 高级特性

| 类别           | 支持内容                                                                 |
|----------------|-------------------------------------------------------------------------|
| **变量操作**   | `x = 10`、`y = 20`、`result = x + y * 2`                                 |
| **数学函数**   | `sin`、`cos`、`tan`、`sqrt`、`abs`、`log`、`ln`、`exp`                   |
| **数学常量**   | `pi`（π ≈ 3.14159）、`e`（自然对数底 ≈ 2.71828）                          |
| **比较运算**   | `>`、`<`、`>=`、`<=`、`==`、`!=`                                         |
| **逻辑运算**   | `&&`（与）、`||`（或）、`!`（非）                                        |
| **条件表达式** | `condition ? 真值 : 假值`（如 `x > 5 ? x*2 : x/2`）                      |
| **交互界面**   | 支持命令行交互（REPL）与历史记录（上下箭头调用）                          |

---

## 📚 使用示例

```plaintext
> x = 10
> y = 20
> x + y * 2
50

> sqrt(9) + sin(pi/2)
4.0

> 半径 = 5
> 面积 = pi * 半径 ** 2
78.5398

> 温度 = 30
> 温度 > 25 ? "炎热" : "凉爽"
"炎热"

> ! (5 == 5 || 10 < 2)
false
```

---

## 🛠️ 安装与构建

### 依赖环境
- C++17 编译器（g++ 7.0+/clang 5.0+）
- CMake 3.10+

### 构建步骤
```bash
git clone https://github.com/user1-cloud/ExprCalculator2.git
cd ExprCalculator2
mkdir build && cd build
cmake ..
make
```

### 运行程序
```bash
./expr_calculator
```

---

## 📺 交互界面（REPL）

```plaintext
ExprCalculator2 v1.2.0
> x = 5
> y = 10
> x * y + (x + y) ** 2
125
> log(100)
4.60517
> e ** 2
7.38906
> exit
```

---

## ❗ 错误处理示例

```plaintext
> 5 / 0
错误：除以零错误

> sin(30 度)  # 无效单位
错误：未知单位 "度"（需使用弧度）

> x = 10 + y  # y 未定义
错误：未定义变量 "y"

> 5 > 3 && 2 == 2.5
错误：类型不匹配（2.5 不是整数）
```

---

## 🔍 设计亮点

1. **复杂表达式解析**  
   支持嵌套括号与混合运算符：
   ```plaintext
   (3 + 4 * 2) / (sqrt(16) - 2) ** 2
   ```

2. **变量持久化**  
   变量在会话中持续存在直至清除：
   ```plaintext
   > a = 5
   > b = a * 2
   > a = 10
   > b  # 仍为 10
   ```

3. **数学精度保障**  
   基于 C++ 标准数学库（`<cmath>`）实现函数：
   - `sin(π/2) = 1.0`
   - `ln(e) = 1.0`

4. **历史记录功能**  
   按 `↑`/`↓` 调用历史命令（依赖 readline 库）

---

## 🤝 贡献指南

欢迎提交 Pull Request，请遵守：
1. 为新功能添加测试用例
2. 保持代码风格一致
3. 更新相关文档


---

> **注意**：三角函数默认使用**弧度制**，可用 `pi` 表示 π（如 `sin(pi/2)`），`e` 表示自然对数底。  
> **提示**：使用上下箭头快速调用历史命令，输入 `exit` 退出程序。
